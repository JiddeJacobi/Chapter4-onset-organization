---
title: "C-center preprocessing"
output: 
  html_document: 
    number_sections: yes
    toc: yes
    toc_float: yes
    df_print: paged
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Data check

## Load packages
```{r packages}
library("dplyr")
library("tidyr")
library("ggplot2")
library("stringr")
library("tigerstats")
library("ez")
```

## Read data
```{r read}
df <- read.csv("../data/c-center_16th_Sep.csv", header = TRUE, sep = ",")
load("../data/speech_rate.Rda")
df_sr <- drop_na(df_sr)
```

## Merge mview output with speech rate dataframe
```{r}
df <- df %>%
  right_join(df_sr, by=c("subj", "fname"))
rm(df_sr)
```


## Tidy the data
```{r preprocess}
# extract info from filename, merge trialnumber and repetition
df<- df %>%
    separate(fname, c("project", "prompt", "block", "remove", "remove2", "trialno", "repetition"), sep = "_") %>%
    mutate(trial=str_c(trialno,repetition)) 
```

Drop unwanted columns.
```{r}
df <- df %>%
select(-c(project, remove, remove2, x1, x2, x3, x4, x5, x6, x7, y1, y2, y3, y4, y5, y6, y7, z1, z2, z3, z4, z5, z6, z7, v1, v2, v3, v4, v5, v6, v7, X.1, X.2, X.3, DOns, DTarg, DOff))
```

Create new variable recording.no to indicate the recording number (first recording, second recording etc..).
```{r}
trialno <- df %>% 
group_by(subj) %>% 
distinct(trial) %>% 
arrange(trial, by_group = TRUE) %>%
mutate(recording.no = 1:n()) %>% 
select(recording.no, everything()) %>% 
arrange(subj, recording.no)
```

Bind trialno with dataframe.
```{r}
df <- df %>% 
  inner_join(trialno, by = c("subj", "trial")) %>% 
  select(recording.no, everything()) %>% 
  arrange(subj, recording.no)
rm(trialno)
```

Create group variable.
```{r}
df$group <- ifelse((str_detect(df$subj, "CTRL")), "CTRL", "PD")
df$group <-  as.factor(df$group)
```

Create condition based on prompt.
```{r}
df$condition <- "C"
df$condition[df$prompt == "oma spat" | df$prompt == "opa Smat" |df$prompt == "opa schat" | df$prompt == "oma's prak"] <- "CC"
df$condition[df$prompt == "oma sprak"] <- "CCC"
df$condition <-  as.factor(df$condition)
```

Create cluster column.
```{r}
df$cluster[df$prompt == "oma spat" | df$prompt == "oma's pad"] <- "sp" 
df$cluster[df$prompt == "opa schat" | df$prompt == "opa's gat"] <- "sx" 
df$cluster[df$prompt == "opa Smat" | df$prompt == "opa's mat"] <- "sm" 
df$cluster[df$prompt == "oma sprak" | df$prompt == "oma's prak"] <- "spr" 
df$cluster <- as.factor(df$cluster)
levels(df$cluster)
```

Remove faulty segmentation, based on outlier column.
```{r}
df <- df[is.na(df$outl),]
```

Check whether the conditions are well coded and whether the segmentation involves the correct articulators.
```{r}
table(df$prompt, df$condition)
table(df$prompt, df$cluster)
table(df$seg, df$traj)
```

Remove unreliable /sx/ segmentation of PD25.
```{r}
df <- df[!(df$subj == "PD25" & df$cluster == "sx"),]
```


# Preparing data for within cluster analysis

/sp/ CC lag
```{r sp CC lag}
# collect offset times /s/
offset.s <- df %>%
  rowwise() %>%
  filter(prompt == "oma spat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  select(subj, recording.no, t3, t5) %>%
  rename(t3.s = t3) %>%
  rename(t5.s = t5)

# collect onset times /p/ and merge df's
sp.CC <- df %>%
  rowwise() %>%
  filter(prompt == "oma spat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "p") %>%
  select(subj, recording.no, prompt, block, condition, group, cluster, duration.tt, duration.mt,  t3, t5) %>%
  rename(t3.p = t3) %>%
  rename(t5.p = t5) %>%
  inner_join(offset.s, by=c("subj", "recording.no")) %>%
  mutate(time.lag = t3.p-t5.s)  %>%
  mutate(time.lag.norm = time.lag/(t5.p - t3.s))  %>%
  mutate(dur.C1.norm = (t5.s - t3.s)/(t5.p - t3.s)) %>%
  mutate(dur.C2.norm = (t5.p - t3.p)/(t5.p - t3.s))


sp.C1.plot <- ggplot(sp.CC, aes(x = time.lag.norm, y = dur.C1.norm, color = group, shape = group)) + geom_point(size=2)
print(sp.C1.plot + scale_shape_manual(values = c(0, 2)) + scale_colour_manual(values = c("coral2", "seagreen4")) + theme_bw() + labs(title = "Inter plateau interval vs. duration of C1, /sp/", x = "Normalized IPI", y = "Normalized duration C1") + xlim(-1, 1) + ylim(0,1)) 
cor.test(sp.CC$time.lag.norm, sp.CC$dur.C1.norm)

sp.C2.plot <- ggplot(sp.CC, aes(x = time.lag.norm, y = dur.C2.norm, color = group, shape = group)) + geom_point(size=2)
print(sp.C2.plot + scale_shape_manual(values = c(0, 2)) + scale_colour_manual(values = c("coral2", "seagreen4")) + theme_bw() + labs(title = "Inter plateau interval vs. duration of C2, /sp/", x = "Normalized IPI", y = "Normalized duration C2") + xlim(-1, 1) + ylim(0,1)) 
cor.test(sp.CC$time.lag.norm, sp.CC$dur.C2.norm)


rm(sp.C1.plot, sp.C2.plot)

rm(offset.s)

# getting rid of NA's
sp.CC <- na.omit(sp.CC, cols="time.lag.norm")

# plot
ggplot(sp.CC, aes(x=subj, y=time.lag.norm, fill=group, na.rm = T)) + geom_boxplot() + labs(title = "CTRL: /sp/", y = "Lag between C's")
```

/sm/ CC lag
```{r sm CC lag}
# collect  offset times /s/
offset.s <- df %>%
  rowwise() %>%
  filter(prompt == "opa Smat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  select(subj, recording.no, t3, t5) %>%
  rename(t5.s = t5, t3.s = t3)
  
# collect offset times /m/
sm.CC <- df %>%
  rowwise() %>%
  filter(prompt == "opa Smat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "m") %>%
  select(subj, recording.no, prompt, block, condition, group, cluster, duration.tt, duration.mt,  t3, t5) %>%
  rename(t3.m = t3, t5.m = t5)  %>%
  inner_join(offset.s, by=c("subj", "recording.no")) %>%
  mutate(time.lag = t3.m-t5.s) %>%
  mutate(time.lag.norm = time.lag/(t5.m - t3.s))  %>%
  mutate(dur.C1.norm = (t5.s - t3.s)/(t5.m - t3.s))  %>%
  mutate(dur.C2.norm = (t5.m - t3.m)/(t5.m - t3.s))


sm.C1.plot <- ggplot(sm.CC, aes(x = time.lag.norm, y = dur.C1.norm, color = group, shape = group)) + geom_point(size=2)
print(sm.C1.plot + scale_shape_manual(values = c(0, 2)) + scale_colour_manual(values = c("coral2", "seagreen4")) + theme_bw() + labs(title = "Inter plateau interval vs. duration of C1, /sm/", x = "Normalized IPI", y = "Normalized duration C1") + xlim(-1, 1) + ylim(0,1))
cor.test(sm.CC$time.lag.norm, sm.CC$dur.C1.norm)

sm.C2.plot <- ggplot(sm.CC, aes(x = time.lag.norm, y = dur.C2.norm, color = group, shape = group)) + geom_point(size=2)
print(sm.C2.plot + scale_shape_manual(values = c(0, 2)) + scale_colour_manual(values = c("coral2", "seagreen4")) + theme_bw() + labs(title = "Inter plateau interval vs. duration of C2, /sm/", x = "Normalized IPI", y = "Normalized duration C2") + xlim(-1, 1) + ylim(0,1))
cor.test(sm.CC$time.lag.norm, sm.CC$dur.C2.norm)


rm(sm.C1.plot, sm.C2.plot)
rm(offset.s)

# getting rid of NA's
sm.CC <- na.omit(sm.CC, cols="time.lag.norm")

# plot
ggplot(sm.CC, aes(x=subj, y=time.lag.norm, fill=group, na.rm = T)) + geom_boxplot() + labs(title = "PD: /sm/", y = "Lag between C's (ms)")
```

/sx/ CC lag
```{r}
# collect on and offset times /s/
offset.s <- df %>%
  rowwise() %>%
  filter(prompt == "opa schat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  select(subj, recording.no, t3, t5) %>%
  rename(t3.s = t3, t5.s = t5)

# collect onset times /x/
sx.CC <- df %>%
  rowwise() %>%
  filter(prompt == "opa schat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "X") %>%
  select(subj, recording.no, prompt, block, condition, group, cluster, duration.tt, duration.mt,  t3, t5) %>%
  rename(t3.x = t3, t5.x = t5)  %>%
  inner_join(offset.s, by=c("subj", "recording.no")) %>%
  mutate(time.lag = t3.x-t5.s) %>%
  mutate(time.lag.norm = time.lag/(t5.x - t3.s)) %>%
  mutate(dur.C1.norm = (t5.s - t3.s)/(t5.x - t3.s))  %>%
  mutate(dur.C2.norm = (t5.x - t3.x)/(t5.x - t3.s)) %>%
  filter(t3.x > t3.s)
 
# remove trials where NONS /X/ preceeds /s/
 



sx.C1.plot <- ggplot(sx.CC, aes(x = time.lag.norm, y = dur.C1.norm, color = group, shape = group)) + geom_point(size=2)
print(sx.C1.plot + scale_shape_manual(values = c(0, 2)) + scale_colour_manual(values = c("coral2", "seagreen4")) + theme_bw() + labs(title = "Inter plateau interval vs. duration of C1, /sx/", x = "Normalized IPI", y = "Normalized duration C1") + xlim(-1, 1) + ylim(0,1))
cor.test(sx.CC$time.lag.norm, sx.CC$dur.C1.norm)

sx.C2.plot <- ggplot(sx.CC, aes(x = time.lag.norm, y = dur.C2.norm, color = group, shape = group)) + geom_point(size=2)
print(sx.C2.plot + scale_shape_manual(values = c(0, 2)) + scale_colour_manual(values = c("coral2", "seagreen4")) + theme_bw() + labs(title = "Inter plateau interval vs. duration of C2, /sx/", x = "Normalized IPI", y = "Normalized duration C2") + xlim(-1, 1) + ylim(0,1))
cor.test(sx.CC$time.lag.norm, sx.CC$dur.C2.norm)

rm(sx.C1.plot, sx.C2.plot)

rm(offset.s)



# getting rid of NA's
sx.CC <- na.omit(sx.CC, cols="time.lag.norm")


# plot
ggplot(sx.CC, aes(x=subj, y=time.lag.norm, fill=group, na.rm = T)) + geom_boxplot() + labs(title = "PD: /sx/", y = "Lag between C's (ms)")
```

/s-r/ CC lag
```{r}
# collect on and offset times /s/
offset.s <- df %>%
  rowwise() %>%
  filter(prompt == "oma's prak") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  select(subj, recording.no, t3, t5) %>%
  rename(t3.s = t3, t5.s = t5)

# collect on and offset times /p/
offset.p <- df %>%
  rowwise() %>%
  filter(prompt == "oma's prak") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "p") %>%
  select(subj, recording.no, t3, t5) %>%
  rename(t3.p = t3, t5.p = t5)

# collect on and offset times /r/
spr.CC <- df %>%
  rowwise() %>%
  filter(prompt == "oma's prak") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "r") %>%
  select(subj, recording.no, prompt, block, condition, group, cluster, duration.tt, duration.mt,  t3, t5) %>%
  rename(t3.r = t3, t5.r = t5)  %>%
  inner_join(offset.s, by=c("subj", "recording.no")) %>%
  left_join(offset.p, by=c("subj", "recording.no")) %>%
  mutate(time.lag = t3.r-t5.s) %>%
  mutate(time.lag.norm = time.lag/(t5.r - t3.s)) %>%
  mutate(dur.C1.norm = (t5.s - t3.s)/(t5.r - t3.s))  %>%
  mutate(dur.C2.norm = (t5.p - t3.p)/(t5.r - t3.s))  %>%
  mutate(dur.C3.norm = (t5.r - t3.r)/(t5.r - t3.s))



spr.C1.plot <- ggplot(spr.CC, aes(x = time.lag.norm, y = dur.C1.norm, color = group, shape = group)) + geom_point(size=2)
print(spr.C1.plot + scale_shape_manual(values = c(0, 2)) + scale_colour_manual(values = c("coral2", "seagreen4")) + theme_bw() + labs(title = "Inter plateau interval vs. duration of C1, /spr/", x = "Normalized IPI", y = "Normalized duration C1") + xlim(-1, 1) + ylim(0,1))
cor.test(spr.CC$time.lag.norm, spr.CC$dur.C1.norm)

spr.C2.plot <- ggplot(spr.CC, aes(x = time.lag.norm, y = dur.C2.norm, color = group, shape = group)) + geom_point(size=2)
print(spr.C2.plot + scale_shape_manual(values = c(0, 2)) + scale_colour_manual(values = c("coral2", "seagreen4")) + theme_bw() + labs(title = "Inter plateau interval vs. duration of C2, /spr/", x = "Normalized IPI", y = "Normalized duration C2") + xlim(-1, 1) + ylim(0,1))
cor.test(spr.CC$time.lag.norm, spr.CC$dur.C2.norm)

spr.C3.plot <- ggplot(spr.CC, aes(x = time.lag.norm, y = dur.C3.norm, color = group, shape = group)) + geom_point(size=2)
print(spr.C3.plot + scale_shape_manual(values = c(0, 2)) + scale_colour_manual(values = c("coral2", "seagreen4")) + theme_bw() + labs(title = "Inter plateau interval vs. duration of C3, /spr/", x = "Normalized IPI", y = "Normalized duration C3") + xlim(-1, 1) + ylim(0,1))
rm(spr.C1.plot, spr.C2.plot, spr.C3.plot)
cor.test(spr.CC$time.lag.norm, spr.CC$dur.C3.norm)

rm(offset.s, offset.p)

# getting rid of NA's
spr.CC <- na.omit(spr.CC, cols="time.lag.norm")

# plot
ggplot(spr.CC, aes(x=subj, y=time.lag.norm, fill=group, na.rm = T)) + geom_boxplot() + labs(title = "PD: /spr/", y = "Lag between /s/ and /r/ (ms)")
```

Merge.
```{r merge}
df.CC.lag<- rbind(sm.CC, sp.CC, sx.CC, spr.CC)
rm(sm.CC, sp.CC, sx.CC, spr.CC)
```


## Some plots
```{r plots}
dodge <- position_dodge(width = 0.9)

ggplot(df.CC.lag, aes(x=condition, y=time.lag, fill=group)) + geom_violin() + labs(title = "CC lag all clusters", y = "Lag between C's") + geom_boxplot(width=.2, position = dodge)
ggplot(df.CC.lag[df.CC.lag$cluster == "sp",], aes(x=condition, y=time.lag.norm, fill=group)) + geom_violin() + labs(title = "CC lag /sp/", y = "Lag between C's") + geom_boxplot(width=.2, position = dodge)
ggplot(df.CC.lag[df.CC.lag$cluster == "sm",], aes(x=condition, y=time.lag.norm, fill=group)) + geom_violin() + labs(title = "CC lag /sm/", y = "Lag between C's") + geom_boxplot(width=.2, position = dodge)
ggplot(df.CC.lag[df.CC.lag$cluster == "sx",], aes(x=condition, y=time.lag.norm, fill=group)) + geom_violin() + labs(title = "CC lag /sx/", y = "Lag between C's") + geom_boxplot(width=.2, position = dodge)
ggplot(df.CC.lag[df.CC.lag$cluster == "spr",], aes(x=condition, y=time.lag.norm, fill=group)) + geom_violin() + labs(title = "CC lag /spr/", y = "Lag between /s/ and /r/") + geom_boxplot(width=.2, position = dodge)

```
# Examine duration of words
```{r}
start.word.complex <- df %>%
  rowwise() %>%
  filter(prompt == "opa schat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  select(subj, recording.no, t3, prompt) %>%
  rename(start = t3)

dur.word.complex <- df %>%
  rowwise() %>%
  filter(prompt == "opa schat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "t") %>%
  select(subj, recording.no, t3, prompt) %>%
  rename(finish = t3)  %>%
  inner_join(start.word.complex, by=c("subj", "recording.no"))  %>%
  mutate(dur.word = finish-start)

start.word.simplex <- df %>%
  rowwise() %>%
  filter(prompt == "opa's gat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "X") %>%
  select(subj, recording.no, t3, prompt) %>%
  rename(start = t3)

dur.word.simplex <- df %>%
  rowwise() %>%
  filter(prompt == "opa's gat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "t") %>%
  select(subj, recording.no, t3, prompt) %>%
  rename(finish = t3)  %>%
  inner_join(start.word.simplex, by=c("subj", "recording.no"))  %>%
  mutate(dur.word = finish-start)

duration.word <- rbind(dur.word.simplex, dur.word.complex)

boxplot(dur.word~prompt.y, data=duration.word)

rm(start.word.complex, start.word.simplex, dur.word.simplex, dur.word.complex, duration.word)

```


# Examining duration of C's in onset.
```{r}
df <- df %>%
    rowwise() %>%
    mutate(dur=t5 - t3) #%>%
    #group_by(cluster, seg) %>%
    #mutate(norm.dur = scale(dur))


mean.dur.C <- df %>%
  group_by(cluster, condition, subj) %>%
  filter(condition == "C") %>%
  filter(seg == "p"| seg == "m" | seg == "X") %>%
  group_by(seg) %>%
  select(cluster, condition, subj, seg, dur) %>%
  mutate(mean.dur.C = mean(dur, na.rm=T), sd.dur.C = sd(dur, na.rm=T)) %>%
  distinct(subj, seg, mean.dur.C, sd.dur.C)  


df %>%
  group_by(cluster, condition, subj) %>%
  filter(condition == "C" | condition == "CC") %>%
  filter(seg == "p"| seg == "m" | seg == "X") %>%
  group_by(seg) %>%
  select(cluster, condition, subj, seg, dur) %>%
  group_by(cluster, condition) %>%
  summarize(mean.dur.C = mean(dur, na.rm=T), sd.dur.C = sd(dur, na.rm=T))



diff <- df %>%
  group_by(cluster, condition, subj) %>%
  filter(condition == "CC") %>%
  filter(seg == "p"| seg == "m" | seg == "X") %>%
  group_by(seg, subj) %>%
  select(cluster, condition, subj, seg, dur) %>%
  mutate(mean.dur.CC = mean(dur, na.rm=T)) %>%
  distinct(subj, seg, mean.dur.CC) %>%
  inner_join(mean.dur.C, by=c("subj", "seg")) %>%
  mutate(diff = mean.dur.C - mean.dur.CC)

diff %>%
  group_by(seg) %>%
  summarize(mean = mean(diff, na.rm=T), sd = sd(diff, na.rm=T))

rm(mean.dur.C, diff)
```

Plot durations of right C per group:
```{r}
require(gridExtra)

dodge <- position_dodge(width = 0.9)

plot1 <-  ggplot(df[df$cluster == 'sp' & df$seg == "p",], aes(x=group, y=dur, fill=condition)) + labs(title = "Duration /p/", y = "Duration (ms)", x = "Group") + geom_boxplot(width=.2, position = dodge)

plot2 <- ggplot(df[df$cluster == 'sm' & df$seg == "m",], aes(x=group, y=dur, fill=condition)) + labs(title = "Duration /m/", y = "Duration (ms)", x = "Group") + geom_boxplot(width=.2, position = dodge)

plot3 <-  ggplot(df[df$cluster == 'sx' & df$seg == "X",], aes(x=group, y=dur, fill=condition))  + labs(title = "Duration /x/", y = "Duration (ms)", x = "Group") + geom_boxplot(width=.2, position = dodge)

plot4 <-  ggplot(df[df$cluster == 'spr' & df$seg == "r",], aes(x=group, y=dur, fill=condition)) + labs(title = "Duration /r/", y = "Duration (ms)", x = "Group") + geom_boxplot(width=.2, position = dodge)

grid.arrange(plot1, plot2, plot3, plot4, ncol=2)
rm(plot1, plot2, plot3, plot4)

```

Plot durations of right C per subject:
```{r}
ggplot(df[df$cluster == 'sm' & df$seg == "m" & df$group == "CTRL",], aes(x=subj, y=dur, fill=condition)) + geom_violin() + labs(title = "duration /m/ CTRL", y = "duration") + geom_boxplot(width=.2, position = dodge) + ylim(0, 300)

ggplot(df[df$cluster == 'sm' & df$seg == "m" & df$group == "PD",], aes(x=subj, y=dur, fill=condition)) + geom_violin() + labs(title = "duration /m/ PD", y = "duration") + geom_boxplot(width=.2, position = dodge) + ylim(0, 300)

ggplot(df[df$cluster == 'sp' & df$seg == "p" & df$group == "CTRL",], aes(x=subj, y=dur, fill=condition)) + geom_violin() + labs(title = "duration /p/ CTRL", y = "duration") + geom_boxplot(width=.2, position = dodge) + ylim(0, 300)

ggplot(df[df$cluster == 'sp' & df$seg == "p" & df$group == "PD",], aes(x=subj, y=dur, fill=condition)) + geom_violin() + labs(title = "duration /p/ PD", y = "duration") + geom_boxplot(width=.2, position = dodge) + ylim(0, 300)
```

Plot duration of first C per group
```{r}
ggplot(df[df$cluster == 'sm' & df$seg == "s",], aes(x=group, y=dur, fill=condition)) + geom_violin() + labs(title = "duration /s/ in /sm/ and /s#m/", y = "duration") + geom_boxplot(width=.2, position = dodge) + ylim(0, 300)

ggplot(df[df$cluster == 'sp' & df$seg == "s",], aes(x=group, y=dur, fill=condition)) + geom_violin() + labs(title = "duration /s/ in /sp/ and /s#p/", y = "duration") + geom_boxplot(width=.2, position = dodge) + ylim(0, 300)
```

Compare duration of C's in onset per group
```{r}
ggplot(df[df$cluster == 'sm' & df$seg != "ɑ" & df$seg != "t" & df$condition == "CC",], aes(x=group, y=dur, fill=seg)) + geom_violin() + labs(title = "duration /s/ and /m/ in CC, CTRL", y = "duration") + geom_boxplot(width=.2, position = dodge) + ylim(0, 300)


ggplot(df[df$cluster == 'sp' & df$seg != "ɑ" & df$seg != "t" & df$condition == "CC",], aes(x=group, y=dur, fill=seg)) + geom_violin() + labs(title = "duration /s/ and /p/ in CC, CTRL", y = "duration") + geom_boxplot(width=.2, position = dodge) + ylim(0, 300)
```

Compare duration of C's in onset per subj
```{r}
ggplot(df[df$group == 'CTRL' & df$cluster == 'sm' & df$seg != "ɑ" & df$seg != "t" & df$condition == "CC",], aes(x=subj, y=dur, fill=seg)) + geom_violin() + labs(title = "duration /s/ and/m/ in CC, CTRL", y = "duration") + geom_boxplot(width=.2, position = dodge) + ylim(0, 300)

ggplot(df[df$group == 'PD' & df$cluster == 'sm' & df$seg != "ɑ" & df$seg != "t" & df$condition == "CC",], aes(x=subj, y=dur, fill=seg)) + geom_violin() + labs(title = "duration /s/ and/m/ in CC, PD", y = "duration") + geom_boxplot(width=.2, position = dodge) + ylim(0, 300)

ggplot(df[df$group == 'CTRL' & df$cluster == 'sp' & df$seg != "ɑ" & df$seg != "t" & df$condition == "CC",], aes(x=subj, y=dur, fill=seg)) + geom_violin() + labs(title = "duration /s/ and/p/ in CC, CTRL", y = "duration") + geom_boxplot(width=.2, position = dodge) + ylim(0, 300)

ggplot(df[df$group == 'PD' & df$cluster == 'sp' & df$seg != "ɑ" & df$seg != "t" & df$condition == "CC",], aes(x=subj, y=dur, fill=seg)) + geom_violin() + labs(title = "duration /s/ and /p/ in CC, PD", y = "duration") + geom_boxplot(width=.2, position = dodge) + ylim(0, 300)
```
## Density plots duration

```{r}

ggplot(df[df$cluster == 'sp' & df$seg == "p" & df$group == "CTRL",], aes(x=dur, fill = condition)) +
geom_density(alpha=0.4) +  ggtitle("Distribution duration /p/, CTRL") + xlim(0, 200)

ggplot(df[df$cluster == 'sp' & df$seg == "p" & df$group == "PD",], aes(x=dur, fill = condition)) +
geom_density(alpha=0.4) +  ggtitle("Distribution duration /p/, PD") + xlim(0, 200)


ggplot(df[df$cluster == 'sm' & df$seg == "m" & df$group == "CTRL",], aes(x=dur, fill = condition)) +
geom_density(alpha=0.4) +  ggtitle("Distribution duration /m/, CTRL") + xlim(0, 200)


ggplot(df[df$cluster == 'sm' & df$seg == "m" & df$group == "PD",], aes(x=dur, fill = condition)) +
geom_density(alpha=0.4) +  ggtitle("Distribution duration /m/, PD") + xlim(0, 200)


ggplot(df[df$cluster == 'sx' & df$seg == "X" & df$group == "CTRL",], aes(x=dur, fill = condition)) +
geom_density(alpha=0.4) +  ggtitle("Distribution duration /x/, CTRL") + xlim(0, 200)


ggplot(df[df$cluster == 'sx' & df$seg == "X" & df$group == "PD",], aes(x=dur, fill = condition)) +
geom_density(alpha=0.4) +  ggtitle("Distribution duration /x/, PD") + xlim(0, 200)
  
```



# Examining landmarks

## Derive temporal midpoint of nucleus
```{r}
df <- df %>%
  rowwise() %>%
  mutate(mid.nuc=mean(c(t3, t5), na.rm=T)) 
```


## Examine relation gestural onset/offest to nucleus midpoint
```{r}
df.density <- df %>%
  rowwise() %>%
  mutate(GONS = mid.nuc - t1) %>%
  mutate(GOFF = t7 - mid.nuc)  %>%
  gather(side, time.to.mid, GONS:GOFF, factor_key=TRUE, na.rm = T)

  ggplot(df.density[df.density$condition == 'C' & df.density$seg == "s",], aes(x=time.to.mid, fill = side)) +
  geom_density(alpha=0.4) +  ggtitle("Distribution time to midpoint /s/ in C")
  
  ggplot(df.density[df.density$condition == 'CC' & df.density$seg == "s",], aes(x=time.to.mid, fill = side)) +
  geom_density(alpha=0.4) +  ggtitle("Distribution time to midpoint /s/ in CC")
    
  ggplot(df.density[df.density$condition == 'C' & df.density$seg == "m",], aes(x=time.to.mid, fill = side)) +
  geom_density(alpha=0.4) +  ggtitle("Distribution time to midpoint /m/ in C")
  
    ggplot(df.density[df.density$condition == 'CC' & df.density$seg == "m",], aes(x=time.to.mid, fill = side)) +
  geom_density(alpha=0.4) +  ggtitle("Distribution time to midpoint /m/ in CC")
    
      ggplot(df.density[df.density$condition == 'C' & df.density$seg == "p",], aes(x=time.to.mid, fill = side)) +
  geom_density(alpha=0.4) +  ggtitle("Distribution time to midpoint /p/ in C")
  
    ggplot(df.density[df.density$condition == 'CC' & df.density$seg == "p",], aes(x=time.to.mid, fill = side)) +
  geom_density(alpha=0.4) +  ggtitle("Distribution time to midpoint /p/ in CC")
    
      ggplot(df.density[df.density$condition == 'C' & df.density$seg == "X",], aes(x=time.to.mid, fill = side)) +
  geom_density(alpha=0.4) +  ggtitle("Distribution time to midpoint /x/ in C")
  
    ggplot(df.density[df.density$condition == 'CC' & df.density$seg == "X",], aes(x=time.to.mid, fill = side)) +
  geom_density(alpha=0.4) +  ggtitle("Distribution time to midpoint /x/ in CC")
    
rm(df.density)
```

# Preparing data for C-center analysis based on nucleus on and offset


## Calculate lag's for /sp/ 

Derive temporal midpoint of IPI
```{r}
# derive IPI simplex condition
sp.IPI.simplex <- df %>%
  filter(prompt == "oma's pad") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "p") %>%
  rename(IPI = mid.nuc) %>%
  select(subj, prompt, recording.no, IPI) %>%
  select(subj, recording.no, IPI) 

# derive offset onset /s/ 
offset.s <- df %>%
  filter(prompt == "oma spat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  rename(OFFS.s = t5) %>%
  select(subj, prompt, recording.no, OFFS.s)
  
# derive time of onset /p/ 
onset.p <- df %>%
  filter(prompt == "oma spat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "p") %>%
  rename(ONS.p = t3) %>%
  select(subj, prompt, recording.no,  ONS.p)


# calculate IPI
sp.IPI.complex <- offset.s %>%
  left_join(onset.p, by=c("subj", "prompt", "recording.no")) %>%
  rowwise() %>%
  mutate(IPI= OFFS.s + ((ONS.p - OFFS.s)/2)) %>%
  select(subj, recording.no, IPI) %>%
  drop_na()    

sp.IPI <- rbind(sp.IPI.simplex, sp.IPI.complex)

rm(sp.IPI.simplex, sp.IPI.complex, offset.s, onset.p)
```


```{r sp C-center}
# derive time of nucleus midpoint onset /p/ 
mid.nuc.p <- df %>%
  filter(prompt == "oma spat" | prompt == "oma's pad" ) %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "p") %>%
  rename(mid.nuc.p = mid.nuc) %>%
  select(subj, prompt, recording.no, mid.nuc.p) %>%
  drop_na()   
  
# derive time of nucleus midpoint onset /s/ 
mid.nuc.s <- df %>%
  filter(prompt == "oma spat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  rename(mid.nuc.s = mid.nuc) %>%
  select(subj, prompt, recording.no,  mid.nuc.s) %>%
  drop_na()    

# calculate C-center
sp.c.center <- mid.nuc.p %>%
  filter(prompt == "oma spat" | prompt == "oma's pad" ) %>%
  left_join(mid.nuc.s, by=c("subj", "prompt", "recording.no")) %>%
  rowwise() %>%
  mutate(c.center = case_when(prompt == "oma's pad" ~ mid.nuc.p, prompt == "oma spat" ~ mean(c(mid.nuc.s, mid.nuc.p)))) %>%
  select(subj, recording.no, c.center) %>%
  drop_na()    

rm(mid.nuc.p, mid.nuc.s)
```

Get rightedge /sp/ 
```{r}
# collect offset times /p/ 
sp.rightedge <- df %>%
  filter(prompt == "oma spat" | prompt == "oma's pad" ) %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "p") %>%
  rename(rightedge = t7) %>%
  select(subj, recording.no, rightedge) %>%
  drop_na()    
```


Get leftedge /sp/ 
```{r}
# collect onset times /s/ 
 sp.leftedge.CC <- df %>%
  filter(prompt == "oma spat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  rename(leftedge = t3) %>%
  select(subj, recording.no, leftedge) %>%
  drop_na()    
```

Get leftedge /p/ 
```{r}
# collect offset times /p/ 
sp.leftedge.C <- df %>%
  filter(prompt == "oma's pad") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "p") %>%
  rename(leftedge = t3) %>%
  select(subj, recording.no, leftedge) %>%
  drop_na()    
```

Merge 
```{r}
sp.leftedge <- rbind(sp.leftedge.CC, sp.leftedge.C)
rm(sp.leftedge.CC, sp.leftedge.C)
```

Get anchor /t/ 
```{r}
# collect onset times coda /t/
sp.anchor <- df %>%
  filter(prompt == "oma spat" | prompt == "oma's pad" ) %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "t") %>%
  rename(anchor = t3) %>%
  select(subj, recording.no, anchor) %>%
  drop_na()    
```

Merge and remove obsolete df's
```{r}
df.C.center.sp <- df %>%
  filter(prompt == "oma spat" | prompt == "oma's pad" ) %>%
  left_join(sp.c.center, by =c("subj", "recording.no")) %>%
  left_join(sp.rightedge, by =c("subj", "recording.no")) %>%
  left_join(sp.leftedge, by =c("subj", "recording.no")) %>%
  left_join(sp.IPI, by =c("subj", "recording.no")) %>%
  left_join(sp.anchor, by =c("subj", "recording.no"))

rm(sp.c.center, sp.rightedge, sp.leftedge, sp.anchor, sp.IPI)
```


## Calculate lag's for /sm/ 

Derive temporal midpoint of IPI
```{r}
# derive IPI simplex condition
sm.IPI.simplex <- df %>%
  filter(prompt == "opa's mat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "m") %>%
  rename(IPI = mid.nuc) %>%
  select(subj, prompt, recording.no, IPI) %>%
  select(subj, recording.no, IPI) 

# derive offset onset /s/ 
offset.s <- df %>%
  filter(prompt == "opa Smat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  rename(OFFS.s = t5) %>%
  select(subj, prompt, recording.no, OFFS.s)
  
# derive time of onset /m/ 
onset.m <- df %>%
  filter(prompt == "opa Smat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "m") %>%
  rename(ONS.m = t3) %>%
  select(subj, prompt, recording.no,  ONS.m)


# calculate IPI
sm.IPI.complex <- offset.s %>%
  left_join(onset.m, by=c("subj", "prompt", "recording.no")) %>%
  rowwise() %>%
  mutate(IPI= OFFS.s + ((ONS.m - OFFS.s)/2)) %>%
  select(subj, recording.no, IPI) %>%
  drop_na()  

sm.IPI <- rbind(sm.IPI.simplex, sm.IPI.complex)

rm(sm.IPI.simplex, sm.IPI.complex, offset.s, onset.m)
```

```{r sm C-center}
# collect mid.nuc time onset /m/ 
mid.nuc.m <- df %>%
  filter(prompt == "opa Smat" | prompt == "opa's mat" ) %>%
  group_by(subj, recording.no) %>%
  filter(seg == "m") %>%
  rename(mid.nuc.m = mid.nuc) %>%
  select(subj, prompt, recording.no, mid.nuc.m) %>%
  drop_na()  

# collect mid.nuc time onset /s/
mid.nuc.s <- df %>%
  filter(prompt == "opa Smat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  rename(mid.nuc.s = mid.nuc) %>%
  select(subj, prompt, recording.no,  mid.nuc.s)  %>%
  drop_na()  

# calculate C-center
sm.c.center <- mid.nuc.m %>%
  filter(prompt == "opa Smat" | prompt == "opa's mat" ) %>%
  left_join(mid.nuc.s, by=c("subj", "prompt", "recording.no")) %>%
  rowwise() %>%
  mutate(c.center = case_when(prompt == "opa's mat" ~ mid.nuc.m, prompt == "opa Smat" ~ mean(c(mid.nuc.s, mid.nuc.m)))) %>%
  select(subj, recording.no, c.center) %>%
  drop_na()  

rm(mid.nuc.m, mid.nuc.s)
```

Get rightedge /sm/ 
```{r}
# collect offset times /m/ 
sm.rightedge <- df %>%
  filter(prompt == "opa Smat" | prompt == "opa's mat" ) %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "m") %>%
  rename(rightedge = t7) %>%
  select(subj, recording.no, rightedge) %>%
  drop_na()  
```

Get leftedge /sm/  
```{r}
# collect onset times /s/ 
 sm.leftedge.CC <- df %>%
  filter(prompt == "opa Smat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  rename(leftedge = t3) %>%
  select(subj, recording.no, leftedge) %>%
  drop_na()  
```

Get leftedge /m/ 
```{r}
# collect onset times /m/ 
sm.leftedge.C <- df %>%
  filter(prompt == "opa's mat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "m") %>%
  rename(leftedge = t3) %>%
  select(subj, recording.no, leftedge) %>%
  drop_na()  
```

Merge 
```{r}
sm.leftedge <- rbind(sm.leftedge.CC, sm.leftedge.C)
rm(sm.leftedge.CC, sm.leftedge.C)
```

Get anchor /t/ 
```{r}
# collect onset times coda /t/
sm.anchor <- df %>%
  filter(prompt == "opa Smat" | prompt == "opa's mat" ) %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "t") %>%
  rename(anchor = t3) %>%
  select(subj, recording.no, anchor) %>%
  drop_na() 
```

Merge and remove obsolete df's
```{r}
df.C.center.sm <- df %>%
  filter(prompt == "opa Smat" | prompt == "opa's mat" ) %>%
  inner_join(sm.c.center, by =c("subj", "recording.no")) %>%
  left_join(sm.rightedge, by =c("subj", "recording.no")) %>%
  left_join(sm.leftedge, by =c("subj", "recording.no")) %>%
  left_join(sm.IPI, by =c("subj", "recording.no")) %>%
  left_join(sm.anchor, by =c("subj", "recording.no"))

rm(sm.c.center, sm.rightedge, sm.leftedge, sm.anchor, sm.IPI)
```


## Calculate lag's for /sx/ 

Derive temporal midpoint of IPI
```{r}
# derive IPI simplex condition
sx.IPI.simplex <- df %>%
  filter(prompt == "opa's gat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "X") %>%
  rename(IPI = mid.nuc) %>%
  select(subj, prompt, recording.no, IPI) %>%
  select(subj, recording.no, IPI) 

# derive offset onset /s/ 
offset.s <- df %>%
  filter(prompt == "opa schat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  rename(OFFS.s = t5) %>%
  select(subj, prompt, recording.no, OFFS.s)
  
# derive time of  /x/ 
onset.x <- df %>%
  filter(prompt == "opa schat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "X") %>%
  rename(ONS.x = t3) %>%
  select(subj, prompt, recording.no,  ONS.x)


# calculate IPI
sx.IPI.complex <- offset.s %>%
  left_join(onset.x, by=c("subj", "prompt", "recording.no")) %>%
  rowwise() %>%
  mutate(IPI= OFFS.s + ((ONS.x - OFFS.s)/2)) %>%
  select(subj, recording.no, IPI) 

sx.IPI <- rbind(sx.IPI.simplex, sx.IPI.complex)

rm(sx.IPI.simplex, sx.IPI.complex, offset.s, onset.x)
```

```{r sx C-center}
# collect mid.nuc time onset /x/ 
mid.nuc.x <- df %>%
  filter(prompt == "opa schat" | prompt == "opa's gat" ) %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "X") %>%
  rename(mid.nuc.x = mid.nuc) %>%
  select(subj, prompt, recording.no, mid.nuc.x) %>%
  drop_na()   
  
# collect mid.nuc time onset /s/
mid.nuc.s <- df %>%
  filter(prompt == "opa schat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  rename(mid.nuc.s = mid.nuc) %>%
  select(subj, prompt, recording.no,  mid.nuc.s) %>%
  drop_na()    

# calculate C-center
sx.c.center <- mid.nuc.x %>%
  filter(prompt == "opa schat" | prompt == "opa's gat" ) %>%
  left_join(mid.nuc.s, by=c("subj", "prompt", "recording.no")) %>%
  rowwise() %>%
  mutate(c.center = case_when(prompt == "opa's gat" ~ mid.nuc.x, prompt == "opa schat" ~ mean(c(mid.nuc.s, mid.nuc.x)))) %>%
  select(subj, recording.no, c.center) %>%
  drop_na()    

rm(mid.nuc.x, mid.nuc.s)
```

Get rightedge /sx/ 
```{r}
# collect offset times /x/ 
sx.rightedge <- df %>%
  filter(prompt == "opa schat" | prompt == "opa's gat" ) %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "X") %>%
  rename(rightedge = t7) %>%
  select(subj, recording.no, rightedge) %>%
  drop_na()   
```


Get leftedge /sx/  
```{r}
# collect onset times /s/ 
 sx.leftedge.CC <- df %>%
  filter(prompt == "opa schat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  rename(leftedge = t3) %>%
  select(subj, recording.no, leftedge) %>%
  drop_na()   
```

Get leftedge /x/ 
```{r}
# collect onset times /m/ 
sx.leftedge.C <- df %>%
  filter(prompt == "opa's gat") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "X") %>%
  rename(leftedge = t3) %>%
  select(subj, recording.no, leftedge) %>%
  drop_na()   
```

Merge 
```{r}
sx.leftedge <- rbind(sx.leftedge.CC, sx.leftedge.C)
rm(sx.leftedge.CC, sx.leftedge.C)
```

Get anchor /t/ 
```{r}
# collect onset times coda /t/
sx.anchor <- df %>%
  filter(prompt == "opa schat" | prompt == "opa's gat" ) %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "t") %>%
  rename(anchor = t3) %>%
  select(subj, recording.no, anchor) %>%
  drop_na()    
```

Merge and remove obsolete df's
```{r}
df.C.center.sx <- df %>%
  filter(prompt == "opa schat" | prompt == "opa's gat" ) %>%
  left_join(sx.c.center, by =c("subj", "recording.no")) %>%
  left_join(sx.rightedge, by =c("subj", "recording.no")) %>%
  left_join(sx.leftedge, by =c("subj", "recording.no")) %>%
  left_join(sx.IPI, by =c("subj", "recording.no")) %>%
  left_join(sx.anchor, by =c("subj", "recording.no"))

rm(sx.c.center, sx.rightedge, sx.leftedge,  sx.anchor, sx.IPI)
```


## Calculate lag's for /spr/ 

Derive temporal midpoint of IPI
```{r}
# derive IPI simplex condition
spr.IPI.simplex <- df %>%
  filter(prompt == "oma's prak") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  rename(IPI = mid.nuc) %>%
  select(subj, prompt, recording.no, IPI) %>%
  select(subj, recording.no, IPI) %>%
  drop_na()    

# derive offset onset /s/ 
offset.s <- df %>%
  filter(prompt == "oma sprak") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  rename(OFFS.s = t5) %>%
  select(subj, prompt, recording.no, OFFS.s) %>%
  drop_na()   
  
# derive onset time of  /r/ 
onset.r <- df %>%
  filter(prompt == "oma sprak") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "r") %>%
  rename(ONS.r = t3) %>%
  select(subj, prompt, recording.no,  ONS.r) %>%
  drop_na()   


# calculate IPI
spr.IPI.complex <- offset.s %>%
  left_join(onset.r, by=c("subj", "prompt", "recording.no")) %>%
  rowwise() %>%
  mutate(IPI= OFFS.s + ((ONS.r - OFFS.s)/2)) %>%
  select(subj, recording.no, IPI) %>%
  drop_na()   

spr.IPI <- rbind(spr.IPI.simplex, spr.IPI.complex)

rm(spr.IPI.simplex, spr.IPI.complex, offset.s, onset.r)
```

```{r spr C-center}
# collect mid.nuc time onset /r/ 
mid.nuc.r <- df %>%
  filter(prompt == "oma sprak" | prompt == "oma's prak" ) %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "r") %>%
  rename(mid.nuc.r = mid.nuc) %>%
  select(subj, prompt, recording.no, mid.nuc.r) %>%
  drop_na()   
  
# collect mid.nuc time onset /p/
mid.nuc.p <- df %>%
  filter(prompt == "oma sprak") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "p") %>%
  rename(mid.nuc.p = mid.nuc) %>%
  select(subj, prompt, recording.no,  mid.nuc.p) %>%
  drop_na()    

# collect mid.nuc time onset /s/
mid.nuc.s <- df %>%
  filter(prompt == "oma sprak") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  rename(mid.nuc.s = mid.nuc) %>%
  select(subj, prompt, recording.no,  mid.nuc.s) %>%
  drop_na()   

# calculate C-center
spr.c.center <- mid.nuc.r %>%
  filter(prompt == "oma sprak" | prompt == "oma's prak" ) %>%
  left_join(mid.nuc.s, by=c("subj", "prompt", "recording.no")) %>%
  left_join(mid.nuc.p, by=c("subj", "prompt", "recording.no")) %>%
  rowwise() %>%
  mutate(c.center = case_when(prompt == "oma's prak" ~ mid.nuc.r, prompt == "oma sprak" ~ mean(c(mid.nuc.s, mid.nuc.p, mid.nuc.r)))) %>%
  select(subj, recording.no, c.center) %>%
  drop_na()  

rm(mid.nuc.r, mid.nuc.s, mid.nuc.p)
```

Get rightedge /spr/ 
```{r}
# collect offset times /r/ 
spr.rightedge <- df %>%
  filter(prompt == "oma sprak" | prompt == "oma's prak" ) %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "r") %>%
  rename(rightedge = t5) %>%
  select(subj, recording.no, rightedge) %>%
  drop_na()   
```

Get leftedge /spr/  
```{r}
# collect onset times /s/ 
spr.leftedge.CCC <- df %>%
  filter(prompt == "oma sprak") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "s") %>%
  rename(leftedge = t3) %>%
  select(subj, recording.no, leftedge) %>%
  drop_na()   
```

Get leftedge /pr/ 
```{r}
# collect onset times /p/ 
spr.leftedge.CC <- df %>%
  filter(prompt == "oma's prak") %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "p") %>%
  rename(leftedge = t3) %>%
  select(subj, recording.no, leftedge) %>%
  drop_na()   
```

Merge 
```{r}
spr.leftedge <- rbind(spr.leftedge.CCC, spr.leftedge.CC)
rm(spr.leftedge.CCC, spr.leftedge.CC)
```

Get anchor /k/ 
```{r}
# collect onset times coda /t/
spr.anchor <- df %>%
  filter(prompt == "oma sprak" | prompt == "oma's prak" ) %>%
  group_by(subj) %>%
  group_by(recording.no) %>%
  filter(seg == "k") %>%
  rename(anchor = t3) %>%
  select(subj, recording.no, anchor) %>%
  drop_na()   
```

Merge and remove obsolete df's
```{r}
df.C.center.spr <- df %>%
  filter(prompt == "oma sprak" | prompt == "oma's prak" ) %>%
  left_join(spr.c.center, by =c("subj", "recording.no")) %>%
  left_join(spr.rightedge, by =c("subj", "recording.no")) %>%
  left_join(spr.leftedge, by =c("subj", "recording.no")) %>%
  left_join(spr.IPI, by =c("subj", "recording.no")) %>%
  left_join(spr.anchor, by =c("subj", "recording.no"))

#rm(spr.c.center, spr.rightedge, spr.leftedge, spr.anchor, spr.IPI)
```


## Merge C-center df's
```{r}
df.C.center <- rbind(df.C.center.sp, df.C.center.sm, df.C.center.sx, df.C.center.spr)
rm(df.C.center.sp, df.C.center.sm, df.C.center.sx, df.C.center.spr)

df.C.center <- df.C.center  %>%
    rowwise() %>%
    mutate(c.center.lag = anchor - c.center) %>%
    mutate(rightedge.lag = anchor - rightedge) %>%
    mutate(leftedge.lag = anchor - leftedge) %>%
    mutate(IPI.lag = anchor - IPI) %>%
    distinct(subj, recording.no, .keep_all = TRUE)

```

## Distribution
```{r}
xtabs(c.center.lag ~ subj, data = df.C.center)
```


## Some plots
### Per group

/sm/
```{r}

ggplot(df.C.center[df.C.center$cluster == 'sm',], aes(x=group, y=c.center.lag, fill=condition)) + geom_violin() + labs(title = "/sm/, c-center", y = "Lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sm',], aes(x=group, y=rightedge.lag, fill=condition)) + geom_violin() + labs(title = "/sm/, rightedge", y = "Lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sm',], aes(x=group, y=leftedge.lag, fill=condition)) + geom_violin() + labs(title = "/sm/, leftedge", y = "Lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)


ggplot(df.C.center[df.C.center$cluster == 'sm',], aes(x=group, y=IPI.lag, fill=condition)) + geom_violin() + labs(title = "/sm/, IPI", y = "Lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)
```

/sp/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'sp',], aes(x=group, y=c.center.lag, fill=condition)) + geom_violin() + labs(title = "/sp/, c-center", y = "Lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sp',], aes(x=group, y=rightedge.lag, fill=condition)) + geom_violin() + labs(title = "/sp/, rightedge", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sp',], aes(x=group, y=leftedge.lag, fill=condition)) + geom_violin() + labs(title = "/sp/, leftedge", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)


ggplot(df.C.center[df.C.center$cluster == 'sp',], aes(x=group, y=IPI.lag, fill=condition)) + geom_violin() + labs(title = "/sp/, IPI", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)
```

/sx/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'sx',], aes(x=group, y=c.center.lag, fill=condition)) + geom_violin() + labs(title = "/sx/, c-center", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sx',], aes(x=group, y=rightedge.lag, fill=condition)) + geom_violin() + labs(title = "/sx/, rightedge", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sx',], aes(x=group, y=leftedge.lag, fill=condition)) + geom_violin() + labs(title = "/sx/, leftedge", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sx',], aes(x=group, y=IPI.lag, fill=condition)) + geom_violin() + labs(title = "/sx/, IPI", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)
```

/spr/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'spr',], aes(x=group, y=c.center.lag, fill=condition)) + geom_violin() + labs(title = "/spr/, c-center", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'spr',], aes(x=group, y=rightedge.lag, fill=condition)) + geom_violin() + labs(title = "/spr/, rightedge", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'spr',], aes(x=group, y=leftedge.lag, fill=condition)) + geom_violin() + labs(title = "/spr/, leftedge", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)
```


### Per individual

/sm/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'sm' & df.C.center$group == 'CTRL',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/sm/, c-center, CTRL", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sm' & df.C.center$group == 'CTRL',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/sm/, rightedge, CTRL", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sm' & df.C.center$group == 'PD',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/sm/, c-center, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sm' & df.C.center$group == 'PD',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/sm/, rightedge, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)
```

/sp/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'sp' & df.C.center$group == 'CTRL',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/sp/, c-center, CTRL", y = "lag") + geom_boxplot(width=.5 )+ ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sp' & df.C.center$group == 'CTRL',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/sp/, rightedge, CTRL", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sp' & df.C.center$group == 'PD',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/sp/, c-center, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sp' & df.C.center$group == 'PD',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/sp/, rightedge, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)
```

/sx/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'sx' & df.C.center$group == 'CTRL',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/sx/, c-center, CTRL", y = "lag") + geom_boxplot(width=.5 )+ ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sx' & df.C.center$group == 'CTRL',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/sx/, rightedge, CTRL", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sx' & df.C.center$group == 'PD',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/sx/, c-center, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sx' & df.C.center$group == 'PD',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/sx/, rightedge, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)
```

/spr/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'spr' & df.C.center$group == 'CTRL',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/spr/, c-center, CTRL", y = "lag") + geom_boxplot(width=.5 )+ ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'spr' & df.C.center$group == 'CTRL',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/spr/, rightedge, CTRL", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'spr' & df.C.center$group == 'PD',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/spr/, c-center, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'spr' & df.C.center$group == 'PD',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/spr/, rightedge, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)
```


## Some plots
### Per group

/sm/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'sm',], aes(x=group, y=c.center.lag, fill=condition)) + geom_violin() + labs(title = "/sm/, c-center", y = "Lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sm',], aes(x=group, y=rightedge.lag, fill=condition)) + geom_violin() + labs(title = "/sm/, rightedge", y = "Lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sm',], aes(x=group, y=leftedge.lag, fill=condition)) + geom_violin() + labs(title = "/sm/, leftedge", y = "Lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)
```

/sp/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'sp',], aes(x=group, y=c.center.lag, fill=condition)) + geom_violin() + labs(title = "/sp/, c-center", y = "Lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sp',], aes(x=group, y=rightedge.lag, fill=condition)) + geom_violin() + labs(title = "/sp/, rightedge", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sp',], aes(x=group, y=leftedge.lag, fill=condition)) + geom_violin() + labs(title = "/sp/, leftedge", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)
```

/sx/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'sx',], aes(x=group, y=c.center.lag, fill=condition)) + geom_violin() + labs(title = "/sx/, c-center", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sx',], aes(x=group, y=rightedge.lag, fill=condition)) + geom_violin() + labs(title = "/sx/, rightedge", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sx',], aes(x=group, y=leftedge.lag, fill=condition)) + geom_violin() + labs(title = "/sx/, leftedge", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)
```

/spr/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'spr',], aes(x=group, y=c.center.lag, fill=condition)) + geom_violin() + labs(title = "/spr/, c-center", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'spr',], aes(x=group, y=rightedge.lag, fill=condition)) + geom_violin() + labs(title = "/spr/, rightedge", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'spr',], aes(x=group, y=leftedge.lag, fill=condition)) + geom_violin() + labs(title = "/spr/, leftedge", y = "lag") + geom_boxplot(width=.2, position = dodge) + ylim(80, 350)
```


### Per individual

/sm/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'sm' & df.C.center$group == 'CTRL',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/sm/, c-center, CTRL", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sm' & df.C.center$group == 'CTRL',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/sm/, rightedge, CTRL", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sm' & df.C.center$group == 'PD',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/sm/, c-center, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sm' & df.C.center$group == 'PD',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/sm/, rightedge, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)
```

/sp/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'sp' & df.C.center$group == 'CTRL',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/sp/, c-center, CTRL", y = "lag") + geom_boxplot(width=.5 )+ ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sp' & df.C.center$group == 'CTRL',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/sp/, rightedge, CTRL", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sp' & df.C.center$group == 'PD',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/sp/, c-center, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sp' & df.C.center$group == 'PD',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/sp/, rightedge, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)
```

/sx/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'sx' & df.C.center$group == 'CTRL',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/sx/, c-center, CTRL", y = "lag") + geom_boxplot(width=.5 )+ ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sx' & df.C.center$group == 'CTRL',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/sx/, rightedge, CTRL", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sx' & df.C.center$group == 'PD',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/sx/, c-center, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'sx' & df.C.center$group == 'PD',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/sx/, rightedge, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)
```

/spr/
```{r}
ggplot(df.C.center[df.C.center$cluster == 'spr' & df.C.center$group == 'CTRL',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/spr/, c-center, CTRL", y = "lag") + geom_boxplot(width=.5 )+ ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'spr' & df.C.center$group == 'CTRL',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/spr/, rightedge, CTRL", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'spr' & df.C.center$group == 'PD',], aes(x=subj, y=c.center.lag, fill=condition)) +  labs(title = "/spr/, c-center, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)

ggplot(df.C.center[df.C.center$cluster == 'spr' & df.C.center$group == 'PD',], aes(x=subj, y=rightedge.lag, fill=condition)) +  labs(title = "/spr/, rightedge, PD", y = "lag") + geom_boxplot(width=.5) + ylim(80, 350)
```


## Derive standard deviations
```{r}
df.RSD <- df.C.center %>%
  group_by(subj, cluster) %>%
  drop_na(leftedge.lag, rightedge.lag, c.center.lag) %>%
  mutate(sd.leftedge = sd(leftedge.lag)) %>%
  mutate(mean.dur.leftedge = mean(leftedge.lag)) %>%
  mutate(RSD.leftedge = 100*sd.leftedge/mean.dur.leftedge) %>%

  mutate(sd.rightedge = sd(rightedge.lag)) %>%
  mutate(mean.dur.rightedge = mean(rightedge.lag)) %>%
  mutate(RSD.rightedge = 100*sd.rightedge/mean.dur.rightedge) %>%
  
  mutate(sd.C.center = sd(c.center.lag)) %>%
  mutate(mean.dur.C.center = mean(c.center.lag)) %>%
  mutate(RSD.C.center = 100*sd.C.center/mean.dur.C.center) %>%
  distinct(subj, RSD.leftedge, RSD.rightedge, RSD.C.center, .keep_all = T)


ggplot(df.RSD, aes(x=subj, y=RSD.leftedge, fill = group)) + geom_boxplot()
ggplot(df.RSD, aes(x=subj, y=RSD.rightedge, fill = group)) + geom_boxplot()
ggplot(df.RSD, aes(x=subj, y=RSD.C.center, fill = group)) + geom_boxplot()

#transform wide format to long format
df.RSD.long <- df.RSD %>%
  group_by(subj, group, cluster) %>%
  gather(condition,RSD,c(RSD.leftedge, RSD.rightedge, RSD.C.center)) %>%
  select(subj, group, cluster, condition, RSD, duration.tt, recording.no) %>%
  arrange(subj, group, recording.no, cluster, condition,  RSD)

df.RSD.long$subj <- as.factor(df.RSD.long$subj)
df.RSD.long$subj <- droplevels(df.RSD.long$subj)

df.RSD.long$condition[df.RSD.long$condition == "RSD.leftedge"] <- "left edge"
df.RSD.long$condition[df.RSD.long$condition == "RSD.rightedge"] <- "right edge"
df.RSD.long$condition[df.RSD.long$condition == "RSD.C.center"] <- "C-center"
df.RSD.long$condition <- as.factor(df.RSD.long$condition)

#ezANOVA(RSD.long, dv=value, wid=subj, within=condition, between=group)

# display group means
df.RSD %>%
  group_by(cluster, group) %>%
  summarize(mean.leftedge = mean(RSD.leftedge), sd.leftedge = sd(RSD.leftedge), mean.rightedge = mean(RSD.rightedge), sd.rightedge = sd(RSD.rightedge), mean.C.center = mean(RSD.C.center), sd.C.center = sd(RSD.C.center)) %>%
gather(condition,value,c(mean.leftedge, mean.rightedge, mean.C.center))
```


# Save data
```{r save}
#add meta_data

setwd("/Users/45598770/Documents/analysis/data")
df_meta <- read.csv("metadata.csv", header = TRUE, sep = ",")
df_meta$gender <- as.factor(df_meta$gender)
df.CC.lag <-  merge(df.CC.lag, df_meta, by="subj")
df.C.center <-  merge(df.C.center, df_meta, by="subj")
df.RSD.long <-  merge(df.RSD.long, df_meta, by="subj")
rm(df_meta)


# Set variables that consist of most datapoints as reference variables
df.CC.lag$gender <- relevel(df.CC.lag$gender, ref = "M")
df.CC.lag$group <- relevel(df.CC.lag$group, ref = "CTRL")
df.CC.lag$dialect <- as.factor(df.CC.lag$dialect)
df.CC.lag$dialect <- relevel(df.CC.lag$dialect, ref = "Rest")

saveRDS(df.CC.lag, file="modelling_data_CC.rds")
saveRDS(df.RSD.long, file="modelling_data_RSD.rds")
saveRDS(df.C.center, file="modelling_C.center.rds")
```

